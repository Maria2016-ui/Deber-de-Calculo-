<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Ecuaciones e Inecuaciones</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; background-color: #f8f8f8; }
    input, button { padding: 10px; margin: 10px 0; width: 100%; max-width: 500px; }
    canvas { background-color: white; margin-top: 20px; }
    .output { white-space: pre-wrap; background: #fff; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
  </style>
</head>
<body>

  <h2>📘 Calculadora de Ecuaciones e Inecuaciones</h2>
  <p>Ejemplos: <i>x^2 - 5x + 6 = 0</i> o <i>x^2 - 4 ≥ 0</i></p>

  <input id="input" placeholder="Escribe tu ecuación o inecuación aquí...">
  <button onclick="resolver()">Resolver</button>

  <h3>🧮 Paso a Paso</h3>
  <div id="pasos" class="output"></div>

  <h3>📈 Gráfica</h3>
  <canvas id="grafico" width="500" height="300"></canvas>

  <h3>📋 Análisis del Ejercicio</h3>
  <div id="analisis" class="output"></div>

<script>
function resolver() {
  const entrada = document.getElementById("input").value;
  const pasos = document.getElementById("pasos");
  const analisis = document.getElementById("analisis");
  pasos.textContent = "";
  analisis.textContent = "";

  try {
    let operador = null;
    if (entrada.includes(">=")) operador = ">=";
    else if (entrada.includes("<=")) operador = "<=";
    else if (entrada.includes(">")) operador = ">";
    else if (entrada.includes("<")) operador = "<";
    else if (entrada.includes("=")) operador = "=";

    if (!operador) throw "No se reconoce el tipo de ecuación o inecuación";

    const partes = entrada.split(operador).map(s => s.trim());
    const f1 = math.simplify(partes[0]);
    const f2 = math.simplify(partes[1]);
    const expr = math.simplify(`(${partes[0]}) - (${partes[1]})`);

    // Paso a paso básico
    pasos.textContent += `Paso 1: Mover todo al lado izquierdo\n  (${partes[0]}) - (${partes[1]}) ${operador} 0\n`;
    pasos.textContent += `Paso 2: Simplificar\n  ${expr.toString()} ${operador} 0\n`;

    // Resolver ecuación o inecuación
    let soluciones;
    if (operador === "=") {
      soluciones = math.solve(expr, 'x');
      pasos.textContent += `Paso 3: Resolver la ecuación\n  Solución: x = ${soluciones.join(", ")}\n`;
      analisis.textContent = `🔍 La ecuación tiene ${soluciones.length} solución(es): ${soluciones.join(", ")}.\nSignifica que la gráfica corta el eje x en esos puntos.`;
    } else {
      const roots = math.solve(expr, 'x');
      const a = expr.coefficients ? expr.coefficients()[0] : null;
      pasos.textContent += `Paso 3: Resolver la inecuación\n  Raíces: x = ${roots.join(", ")}\n`;
      pasos.textContent += `Paso 4: Analizar intervalos con tabla de signos\n`;

      // Análisis de intervalo
      const ordenadas = roots.map(r => parseFloat(r)).sort((a, b) => a - b);
      const signos = [];

      const evaluar = (x) => math.evaluate(expr.toString(), {x: x});

      const intervalos = [
        [-Infinity, ordenadas[0]],
        ...ordenadas.map((r, i) => [ordenadas[i], ordenadas[i+1]]).filter(x => x[1] !== undefined),
        [ordenadas[ordenadas.length - 1], Infinity]
      ];

      for (let i = 0; i < intervalos.length; i++) {
        const [a, b] = intervalos[i];
        const punto = isFinite(a) && isFinite(b) ? (a + b) / 2 : (isFinite(a) ? a + 1 : b - 1);
        const valor = evaluar(punto);
        const cumple = eval(`${valor} ${operador} 0`);
        signos.push(`${a === -Infinity ? "-∞" : a} a ${b === Infinity ? "∞" : b}: ${cumple ? "✅" : "❌"} (f(${punto.toFixed(2)}) = ${valor.toFixed(2)})`);
      }

      pasos.textContent += signos.join("\n");
      analisis.textContent = `🔍 La inecuación se cumple en los intervalos donde aparece ✅. Observa la gráfica para confirmar visualmente.`;
    }

    graficar(expr);

  } catch (err) {
    pasos.textContent = "❌ Error: " + err;
    document.getElementById("grafico").style.display = "none";
  }
}

function graficar(expr) {
  const ctx = document.getElementById("grafico").getContext("2d");

  // Generar datos
  const xs = [], ys = [];
  for (let x = -10; x <= 10; x += 0.1) {
    xs.push(x);
    ys.push(math.evaluate(expr.toString(), {x: x}));
  }

  // Eliminar gráfico anterior
  if (window.chart) window.chart.destroy();

  window.chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: xs,
      datasets: [{
        label: 'f(x)',
        data: ys,
        fill: false,
        borderWidth: 2
      }]
    },
    options: {
      responsive: false,
      scales: {
        x: { title: { display: true, text: 'x' } },
        y: { title: { display: true, text: 'f(x)' } }
      }
    }
  });
}
</script>
</body>
</html>
