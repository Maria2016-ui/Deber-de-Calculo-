<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Derivación Numérica Paso a Paso</title>
  <style>
    body { font-family: Arial; text-align: center; }
    canvas { border: 1px solid black; margin-top: 10px; }
    .pasos { text-align: left; width: 500px; margin: auto; background: #f3f3f3; padding: 10px; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>Derivada usando definición cuadrática</h2>
  <p>Función: f(x) = x² + 2x + 1</p>
  <p>Usamos: f'(x) = lim<sub>Δx→0</sub> [(f(x + Δx) - f(x)) / Δx]</p>
  <div class="pasos" id="pasos"></div>
  <canvas id="grafica" width="600" height="400"></canvas>

  <script>
    // Función cuadrática
    function f(x) {
      return x*x + 2*x + 1;
    }

    // Derivada numérica con pasos
    const x0 = 1;
    const dx = 0.001;
    const fx0 = f(x0);
    const fx0dx = f(x0 + dx);
    const diferencia = fx0dx - fx0;
    const derivada = diferencia / dx;

    // Mostrar pasos
    document.getElementById("pasos").innerHTML = `
      <b>Pasos para calcular f'(x) en x = ${x0}</b><br><br>
      1. f(x) = x² + 2x + 1<br>
      2. x = ${x0}, Δx = ${dx}<br>
      3. f(${x0}) = ${fx0.toFixed(6)}<br>
      4. f(${x0} + ${dx}) = f(${(x0 + dx).toFixed(6)}) = ${fx0dx.toFixed(6)}<br>
      5. Diferencia: f(x+Δx) - f(x) = ${fx0dx.toFixed(6)} - ${fx0.toFixed(6)} = ${diferencia.toFixed(6)}<br>
      6. Derivada aproximada: ${diferencia.toFixed(6)} / ${dx} = <b>${derivada.toFixed(6)}</b><br>
    `;

    // Graficar
    const canvas = document.getElementById("grafica");
    const ctx = canvas.getContext("2d");

    // Escalas
    const toCanvasX = x => 300 + x * 80;
    const toCanvasY = y => 200 - y * 20;

    // Dibujar ejes
    ctx.beginPath();
    ctx.moveTo(0, toCanvasY(0));
    ctx.lineTo(600, toCanvasY(0));
    ctx.moveTo(toCanvasX(0), 0);
    ctx.lineTo(toCanvasX(0), 400);
    ctx.strokeStyle = "#000";
    ctx.stroke();

    // Dibujar función
    ctx.beginPath();
    for (let x = -3; x <= 3; x += 0.01) {
      const cx = toCanvasX(x);
      const cy = toCanvasY(f(x));
      if (x === -3) ctx.moveTo(cx, cy);
      else ctx.lineTo(cx, cy);
    }
    ctx.strokeStyle = "blue";
    ctx.lineWidth = 2;
    ctx.stroke();

    // Dibujar punto (x0, f(x0))
    ctx.beginPath();
    ctx.arc(toCanvasX(x0), toCanvasY(fx0), 5, 0, 2 * Math.PI);
    ctx.fillStyle = "red";
    ctx.fill();

    // Dibujar recta tangente
    ctx.beginPath();
    for (let x = x0 - 2; x <= x0 + 2; x += 0.01) {
      const y = derivada * (x - x0) + fx0;
      const cx = toCanvasX(x);
      const cy = toCanvasY(y);
      if (x === x0 - 2) ctx.moveTo(cx, cy);
      else ctx.lineTo(cx, cy);
    }
    ctx.strokeStyle = "green";
    ctx.lineWidth = 1.5;
    ctx.setLineDash([5, 5]);
    ctx.stroke();
    ctx.setLineDash([]);
  </script>
</body>
</html>

